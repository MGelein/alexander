alexander.markup={currentOpen:-1,insert:function(){var range=alexander.select.getRange();alexander.select.replaceWithHTML("<span contenteditable='false' id='markupStart' class='handle left red'></span>"+range+"<span id='markupEnd' contenteditable='false' class='handle right red'></span>"),alexander.markup.requestID()},requestID:function(){alexander.ajax.req("requestMarkupID","",function(responseText){var objS=$("#markupStart").get(0),objE=$("#markupEnd").get(0);objS.id=responseText+"_start",objE.id=responseText+"_end",objS.title=objE.title=responseText,alexander.markup.registerListeners(),alexander.markup.load(responseText),alexander.markup.list()})},registerListeners:function(){$(".handle").each(function(index,handle){var cHandle=$(handle);cHandle.unbind("mousedown").mousedown(function(event){alexander.markup.load(this.innerHTML)}),cHandle.unbind("mouseover").mouseover(function(event){alexander.markup.highlight(this.title,!0,!0)}),cHandle.unbind("mouseout").mouseout(function(event){alexander.markup.highlight(this.title,!1)})})},list:function(){var markups=$(".handle").filter(function(){return-1!=$(this).attr("id").indexOf("_start")}),markupRow=$("#markupRow");markupRow.children().remove(),markups.each(function(index,markup){var m=$(markup),id=m.attr("id").replace("_start",""),className=m.attr("class").replace("handle","").replace("selected","").replace("left","");markupRow.append("<div class='col-xs-12 markupItem "+className+"' id='"+id+"_holder' markup-id='"+id+"'>Markup<span class='btn-group btn-group-xs pull-right'><button class='btn btn-default' onclick='alexander.markup.move("+id+")'><span class='glyphicon glyphicon-resize-horizontal'></span>&nbsp;Move</button><button class='btn btn-default editButton' onclick='alexander.markup.edit("+id+")'><span class='glyphicon glyphicon-pencil'></span>&nbsp;Edit</button><button class='btn btn-default'><span class='glyphicon glyphicon-search'></span>&nbsp;Focus</button><button class='btn btn-danger'><span class='glyphicon glyphicon-remove-circle'></span>&nbsp;Remove</button></span><div class='markupContent'></div></div>"),alexander.ajax.req("loadMarkup",id,function(response){$("#"+id+"_holder > .markupContent").html(response)})}),$(".markupItem").each(function(index,item){var m=$(item);m.unbind("mouseout").mouseout(function(event){alexander.markup.highlight($(this).attr("markup-id"),!1)}),m.unbind("mouseover").mouseover(function(event){alexander.markup.highlight($(this).attr("markup-id"),!0,!0)})}),$(".markupContent").hide()},edit:function(id){if($(".markupContent").hide(),$(".editButton").html("<span class='glyphicon glyphicon-pencil'></span>&nbsp;Edit"),id==alexander.markup.currentOpen)return alexander.markup.save(id),void(alexander.markup.currentOpen=-1);alexander.markup.currentOpen=id,$("#"+id+"_holder > .markupContent").show(),$("#"+id+"_holder .editButton").html("<span class='glyphicon glyphicon-floppy-disk'></span>&nbsp;Save")},load:function(id){alexander.ajax.req("loadMarkup",id,function(responseText){alexander.markup.registerListeners(),alexander.select.clear()})},move:function(id){var markupStart=$("#"+id+"_start"),markupEnd=$("#"+id+"_end"),startString=markupStart.wrap("<span/>").parent().html(),endString=markupEnd.wrap("<span/>").parent().html();markupStart.unwrap().remove(),markupEnd.unwrap().remove(),alexander.select.replaceWithHTML(startString+alexander.select.getRange()+endString),alexander.markup.registerListeners()},highlight:function(markupID,doHighlight,showWindow){if(void 0!=markupID&&-1!=markupID){void 0==showWindow&&(showWindow=!1);var start=$("#"+markupID+"_start"),end=$("#"+markupID+"_end"),holder=$("#"+markupID+"_holder");doHighlight?(start.addClass("selected"),end.addClass("selected"),holder.addClass("selected")):(start.removeClass("selected"),end.removeClass("selected"),holder.removeClass("selected"))}},save:function(id){var holder=$("#"+id+"_holder"),data={id:id};switch(holder.find(".markupData").attr("markup-type")){case"default":data.content=holder.find(".markupField").val()}alexander.ajax.req("saveMarkup",data,function(response){console.log("response: "+response)})}};