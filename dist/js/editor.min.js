function insertMarkup(){range=alexander.select.getRange(),alexander.select.replaceWithHtml("<span contenteditable='false' id='markupStart' class='handle redHandle'></span>"+range+"<span id='markupEnd' contenteditable='false' class='handle redHandle'></span>"),requestMarkupID()}function moveMarkup(id){mS=$("#"+id+"_start").get(0),mE=$("#"+id+"_end").get(0),mS.parentNode.removeChild(mS),mE.parentNode.removeChild(mE),tmp=alexander.util.ce("p"),tmp.appendChild(mS),startString=tmp.innerHTML,tmp.removeChild(mS),tmp.appendChild(mE),endString=tmp.innerHTML,alexander.select.replaceWithHtml(startString+alexander.select.getRange()+endString),mS=$("#"+id+"_start").get(0),mE=$("#"+id+"_end").get(0),activateHandle(mS),activateHandle(mE)}function loadMarkup(id){var check=$("#holder_"+id).get(0);void 0==check?alexander.ajax.req("loadMarkup",id,function(responseText){addColumn(responseText),activateHandles(),alexander.selection.clear()}):-1==check.className.indexOf("alreadyLoaded")&&(check.className=check.className+" alreadyLoaded",setTimeout(function(){check.className=check.className.replaceAll("alreadyLoaded","")},1e3))}function convertNote(){note=document.getElementsByClassName("annotation")[0],null!=note&&(className="handle ",note.src.endsWith("critBut.png")?className+="blueHandle":note.src.endsWith("transBut.png")?className+="redHandle":note.src.endsWith("fontBut.png")?className+="greenHandle":note.src.endsWith("noteBut.png")&&(className+="yellowHandle"),mS=alexander.util.ce("span"),mS.setAttribute("contenteditable",!1),mS.className=className,activateHandle(mS),mE=alexander.util.ce("span"),mE.setAttribute("contenteditable",!1),mE.className=className,activateHandle(mE),note.parentNode.insertBefore(mE,note.nextSibling),note.parentNode.replaceChild(mS,note),alexander.ajax.req("convertNote",note.id,function(responseText){id=responseText,mS.id=id+"_start",mE.id=id+"_end",mS.title=mS.innerHTML=id,mE.title=mE.innerHTML=id,convertNote()}))}function requestMarkupID(){alexander.ajax.req("requestMarkupID","",function(responseText){objS=$("#markupStart").get(0),objE=$("#markupEnd").get(0),objS.id=responseText+"_start",objE.id=responseText+"_end",objS.innerHTML=objE.innerHTML=responseText,objS.title=objE.title=responseText,activateHandle(objS),activateHandle(objE),loadMarkup(responseText)})}function highlightMarkup(markupID,doHighlight,showWindow){if(-1!=markupID&&(void 0==showWindow&&(showWindow=!1),start=$("#"+markupID+"_start").get(0),end=$("#"+markupID+"_end").get(0),start&&end))if(doHighlight)void 0!=(check=$("#holder_"+markupID).get(0))&&showWindow&&-1==check.className.indexOf("highlightMarkup")&&(check.className=check.className+" highlightMarkup"),start.className=start.className+" handleSelected",end.className=end.className+" handleSelected";else{var check=$("#holder_"+markupID).get(0);void 0!=check&&(check.className=check.className.replaceAll("highlightMarkup","")),start.className=start.className.replaceAll("handleSelected",""),end.className=end.className.replaceAll("handleSelected","")}}function activateHandles(){handles=document.getElementsByClassName("handle");var i,max=handles.length;for(i=0;i<max;i++)activateHandle(handles[i])}function activateHandle(handle){handle.className=handle.className.replaceAll("handleSelected",""),handle.onmousedown=function(){loadedMarkup=this,loadMarkup(this.innerHTML)},handle.onmouseover=function(){highlightMarkup(this.title,!0,!0)},handle.onmouseout=function(){highlightMarkup(this.title,!1)}}function removeColumn(id){var colToRemove=$("#holder_"+id).get(0);if(void 0!=colToRemove)for(colToRemove.parentNode.parentNode.removeChild(colToRemove.parentNode),editorPanes=document.getElementsByClassName("editorHolder"),prevWidth=12,colWidth=12,editorPanes.length>3?(prevWidth=3,colWidth=3):3==editorPanes.length?(prevWidth=3,colWidth=4):2==editorPanes.length?(prevWidth=4,colWidth=6):1==editorPanes.length&&(prevWidth=6,colWidth=12),i=0,max=editorPanes.length,i=0;i<max;i++)editorPanes[i].className=editorPanes[i].className.replace("col-sm-"+prevWidth,"col-sm-"+colWidth)}function addColumn(response){for(editorPanes=document.getElementsByClassName("editorHolder"),prevWidth=12,colWidth=12,editorPanes.length>3?(prevWidth=3,colWidth=3):3==editorPanes.length?(prevWidth=4,colWidth=3):2==editorPanes.length?(prevWidth=6,colWidth=4):1==editorPanes.length&&(prevWidth=12,colWidth=6),i=0,max=editorPanes.length,i=0;i<max;i++)editorPanes[i].className=editorPanes[i].className.replace("col-sm-"+prevWidth,"col-sm-"+colWidth);resizeEditors(),$("#markupRow").append("<div class='editorHolder col-sm-'"+colWidth+"'></div>").find(".editorHolder").html(response),eval($("#loadScript").html()),$("#loadScript").remove()}function resizeEditors(){$(".nicEdit-panelContain").parent().width("100%"),$(".nicEdit-panelContain").parent().next().width("100%"),$(".nicEdit-panelContain").width("100%"),$(".nicEdit-panelContain").next().width("100%")}