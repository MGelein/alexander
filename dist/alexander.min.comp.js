var alexander={version:"1.0.1",author:"Mees Gelein"},AJAX_LOGGING=!1;;alexander.util={getUrlVars:function(){var vars={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value});return vars},ce:function(name){return document.createElement(name)}};;alexander.select={getRange:function(){return r=null,tmp=alexander.util.ce("span"),window.getSelection&&window.getSelection().getRangeAt?(r=window.getSelection().getRangeAt(0),tmp.appendChild(r.extractContents()),tmp.innerHTML):document.selection&&document.selection.createRange?(r=document.selection.createRange(),tmp.appendChild(r.extractContents()),tmp.innerHTML):null},clear:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},replaceWithHTML:function(html){var range,html;if(window.getSelection&&window.getSelection().getRangeAt){(range=window.getSelection().getRangeAt(0)).deleteContents();var div=document.createElement("div");div.innerHTML=html;for(var child,frag=document.createDocumentFragment();child=div.firstChild;)frag.appendChild(child);range.insertNode(frag)}else document.selection&&document.selection.createRange&&(range=document.selection.createRange()).pasteHTML(html)}};;alexander.event={registerDocumentListeners:function(){document.addEventListener("paste",function(e){var pastedText=void 0;return window.clipboardData&&window.clipboardData.getData?pastedText=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(pastedText=e.clipboardData.getData("text/plain")),e.preventDefault(),e.target.value="",document.execCommand("insertHTML",!1,pastedText),!1}),document.onkeydown=function(e){if(188==e.keyCode){if(e.shiftKey)return document.execCommand("insertHTML",!1,"‹"),!1}else if(190==e.keyCode&&e.shiftKey)return document.execCommand("insertHTML",!1,"›"),!1}}};;alexander.account={changePass:function(){var p=$("#pass");p.children().remove();p.append("<form class='form-horizontal' action='index.php' method='post'><input id='newPass' type='password' name='password' placeholder='New Password' class='form-control passField'><input type='password' name='passwordCheck' placeholder='New Password (Repeat)' class='form-control passField'><input type='password' name='passwordOld' placeholder='Old Password' class='form-control passField'><input type='submit' class='btn btn-primary' value='Change Password'></form>"),$("#newPass").focus()}};;alexander.ajax={req:function(method,ajaxData,callbackFn){var ajaxObject={ajaxMethod:method,data:ajaxData};AJAX_LOGGING&&(console.log("AJAX_REQ_START: method="+method),console.log(ajaxData),console.log("AJAX_REQ_END")),$.ajax({type:"POST",url:"ajax.php",data:ajaxObject,success:function(result){AJAX_LOGGING&&(console.log("AJAX_RESP_START"),console.log(result),console.log("AJAX_RESP_END")),callbackFn(result)}})}};;!function(_a){_a.markup={insert:function(){var range=alexander.select.getRange();alexander.select.replaceWithHTML("<span contenteditable='false' id='markupStart' class='handle redHandle'></span>"+range+"<span id='markupEnd' contenteditable='false' class='handle redHandle'></span>"),alexander.markup.requestID()},requestID:function(){alexander.ajax.req("requestMarkupID","",function(responseText){var objS=$("#markupStart").get(0),objE=$("#markupEnd").get(0);objS.id=responseText+"_start",objE.id=responseText+"_end",objS.innerHTML=objE.innerHTML=responseText,objS.title=objE.title=responseText,alexander.markup.registerListeners(),alexander.markup.load(responseText)})},registerListeners:function(){$(".handle").each(function(index,handle){var cHandle=$(handle);cHandle.unbind("mousedown").mousedown(function(event){alexander.markup.load(this.innerHTML)}),cHandle.unbind("mouseover").mouseover(function(event){alexander.markup.highlight(this.title,!0,!0)}),cHandle.unbind("mouseout").mouseout(function(event){alexander.markup.highlight(this.title,!1)})})},load:function(id){void 0==$("#holder_"+id).get(0)&&alexander.ajax.req("loadMarkup",id,function(responseText){alexander.editor.column.add(responseText),alexander.markup.registerListeners(),alexander.select.clear()})},move:function(id){var markupStart=$("#"+id+"_start"),markupEnd=$("#"+id+"_end"),startString=markupStart.wrap().parent().html(),endString=markupEnd.wrap().parent().html();markupStart.unwrap().remove(),markupEnd.unwrap().remove(),alexander.select.replaceWithHTML(startString+alexander.select.getRange()+endString),alexander.markup.registerListeners()},highlight:function(markupID,doHighlight,showWindow){if(void 0==markupID&&-1!=markupID){void 0==showWindow&&(showWindow=!1);var start=$("#"+markupID+"_start"),end=$("#"+markupID+"_end");$("#holder_"+markupID);doHighlight?(void 0!=check&&showWindow&&check.addClass("highlightMarkup"),start.addClass("handleSelected"),end.addClass("handleSelected")):(void 0!=check&&check.removeClass("highlightMarkup"),start.removeClass("handleSelected"),end.removeClass("handleSelected"))}},close:function(markupID){eval($("#close"+markupID+"Script").get(0).innerHTML),alexander.editor.column.remove(markupID)},save:function(markupID){eval($("#close"+markupID+"Script").get(0).innerHTML)}}}(alexander);;!function(_a){_a.editor={column:{width:12,widthClasses:[12,6,4,3],add:function(htmlContent){$("#markupRow").append("<div class='editorHolder newEditor col-sm-1'"+_a.editor.column.width+"'></div>");var newEditor=$(".newEditor").hide();newEditor.addClass("markupEditor"),newEditor.html(htmlContent).removeClass("newEditor"),eval($("#loadScript").html()),$("#loadScript").remove(),alexander.editor.column.resize(),setTimeout(function(){newEditor.fadeIn(200),newEditor.addClass("animated slideInRight"),alexander.editor.column.resize()},300)},remove:function(id){$("#holder_"+id).parent().fadeOut(400,function(){this.remove(),alexander.editor.column.resize()})},resize:function(){var newWidth=alexander.editor.column.widthClasses[Math.max(0,Math.min($(".editorHolder").length,3))-1];$(".editorHolder").removeClass("col-sm-12 col-sm-6 col-sm-4 col-sm-3 col-sm-1").addClass("col-sm-"+newWidth),_a.editor.column.width=newWidth,$(".nicEdit-panelContain").parent().width("100%"),$(".nicEdit-panelContain").parent().next().width("100%"),$(".nicEdit-panelContain").width("100%"),$(".nicEdit-panelContain").next().width("100%")}},new:function(areaID){return editor=new nicEditor({buttonList:["bold","italic","underline","strikeThrough","subscript","superscript"]}),editor.panelInstance(areaID),editor},exit:function(){index=window.location.href.indexOf("?"),window.location=window.location.href.substring(0,index)}}}(alexander);;!function(_a){function appendNote(id,content){if(null==$(id)){var note=alexander.ce("li");note.id=id,note.innerHTML=id+": "+content,$("app").appendChild(note)}}function $(id){return document.getElementById(id)}alexander.print={load:function(handle){void 0!=handle&&alexander.ajax.req("loadMarkup",handle.innerHTML,function(responseText){parts=responseText.split("::"),appendNote(parts[0],parts[1]),handle.className="note",loadHandle(document.getElementsByClassName("handle")[0])})}}}();;!function(_a){function updateTextOverview(){var query=$("#textFilter").val().trim();0!=(query=query.toLowerCase()).length?$(".textlink").each(function(i,item){-1!=$(item).text().toLowerCase().indexOf(query)?$(item).show():$(item).hide()}):$(".textlink").show()}function orderTextOverview(){var order=$("#textOrder").val().trim().toLowerCase(),items=$(".textlink").get(),orderClass=order.startsWith("title")?".loaderTitle":order.startsWith("name")?".loaderName":".loaderAuthor";items.sort(function(a,b){var textA=$(a).find(orderClass).text(),textB=$(b).find(orderClass).text();return textA<textB?1:textB<textA?-1:0}),-1==order.indexOf("desc")&&items.reverse(),$.each(items,function(i,item){$("#textOverview").append(item)})}alexander.text={load:function(){alexander.ajax.req("loadText",alexander.util.getUrlVars().txtID,function(responseText){nicEditors.findEditor("textEditor").setContent(decodeURI(responseText)),alexander.markup.registerListeners()})},save:function(andExit){var saveData={textContent:encodeURI(nicEditors.findEditor("textEditor").getContent().replace(/&nbsp;/g," ")),authorName:$("#authorField").val().toLowerCase(),textName:$("#textNameField").val(),textTitle:$("#titleField").val(),locusF:$("#locusFromField").val(),locusT:$("#locusToField").val(),checkIn:andExit,textStatusSelect:$("#textStatusSelect").val()};alexander.ajax.req("saveText",saveData,function(responseText){switch(responseText){case"OK":andExit&&alexander.editor.exit();break;case"DB_ERR":alert("A database error occured. Saving has failed. Try again later.");break;case"AUTH_RES_ERR":alert("A result error has occured. This authorName is not yet registered. And you don't have the necessary privileges to register a new author");break;default:console.log("ERR:"+responseText)}})},create:function(){alexander.ajax.req("newText","",function(responseText){document.location=responseText})},loadOverview:function(){alexander.ajax.req("loadTextOverview","",function(responseText){$("#textOverview").html(responseText),alexander.text.renderOverview()}),setTimeout(function(){$(".animated.fadeIn").removeClass("animated fadeIn")},500)},renderOverview:function(){updateTextOverview(),orderTextOverview()}}}();;$(document).ready(function(){alexander.event.registerDocumentListeners(),"function"==typeof init&&init()}),String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)},String.prototype.replaceAll=function(search,replacement){return this.replace(new RegExp(search,"g"),replacement)};