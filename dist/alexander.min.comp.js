var alexander={version:"1.0.1",author:"Mees Gelein"},AJAX_LOGGING=!1;;alexander.util={getUrlVars:function(){var vars={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value});return vars},ce:function(name){return document.createElement(name)}};;alexander.select={getRange:function(){return r=null,tmp=alexander.util.ce("span"),window.getSelection&&window.getSelection().getRangeAt?(r=window.getSelection().getRangeAt(0),tmp.appendChild(r.extractContents()),tmp.innerHTML):document.selection&&document.selection.createRange?(r=document.selection.createRange(),tmp.appendChild(r.extractContents()),tmp.innerHTML):null},clear:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},replaceWithHTML:function(html){var range,html;if(window.getSelection&&window.getSelection().getRangeAt){(range=window.getSelection().getRangeAt(0)).deleteContents();var div=document.createElement("div");div.innerHTML=html;for(var child,frag=document.createDocumentFragment();child=div.firstChild;)frag.appendChild(child);range.insertNode(frag)}else document.selection&&document.selection.createRange&&(range=document.selection.createRange()).pasteHTML(html)}};;alexander.event={registerDocumentListeners:function(){document.addEventListener("paste",function(e){var pastedText=void 0;return window.clipboardData&&window.clipboardData.getData?pastedText=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(pastedText=e.clipboardData.getData("text/plain")),e.preventDefault(),e.target.value="",document.execCommand("insertHTML",!1,pastedText),!1}),document.onkeydown=function(e){if(188==e.keyCode){if(e.shiftKey)return document.execCommand("insertHTML",!1,"‹"),!1}else if(190==e.keyCode&&e.shiftKey)return document.execCommand("insertHTML",!1,"›"),!1}}};;alexander.account={user:{edit:function(type){var id="name"==(type=type.toLowerCase())?"#sUserChangeName":"pass"==type?"#sUserChangePass":"#sUserChangeEmail",button=$(id);if(!button.hasClass("disabled")){var inputType;inputType="pass"==type?"password":"email"==type?"email":"text",button.wrap('<div id="temp"></div>'),button.hide(),$("#temp").append('<div id="editingGroup" class="input-group"><input type='+inputType+' placeholder="Type new value here" data-editing="'+type+'" class="form-control"><span class="input-group-btn"><input type="button" class="btn btn-primary" onclick="alexander.account.user.saveEdit(this);" value="OK"></span></div>'),$("#temp").children().unwrap()}},saveEdit:function(source){var dataField=$(source).parent().parent().find("input[data-editing]"),dataType=dataField.attr("data-editing"),buttonId="name"==dataType?"#sUserChangeName":"pass"==dataType?"#sUserChangePass":"#sUserChangeEmail",button=$(buttonId),data=dataField.val();if(!(void 0==data||data.length<1)){var ajaxMethod,selectedUserEmail=$(".userItem.selected").attr("email");"pass"==dataType?ajaxMethod="userChangePass":"email"==dataType?ajaxMethod="userChangeEmail":"name"==dataType&&(ajaxMethod="userChangeName");var ajaxData={edit:data,email:selectedUserEmail};alexander.ajax.req(ajaxMethod,ajaxData,function(response){console.log(response)}),$(dataField).parent().remove(),button.show()}},renderOverview:function(){var query=$("#userFilter").val().trim();0==query.length&&$(".userItem").show(),$(".userItem").each(function(i,user){-1!=$(user).text().indexOf(query)?$(user).show():$(user).hide()})},loadControl:function(userElement){var loading=!$(userElement).hasClass("selected");$(".userItem").removeClass("selected"),loading?($(userElement).addClass("selected"),$("#sUserName").html($(userElement).text()),$("#sUserChangeName").removeClass("disabled"),$("#sUserChangePass").removeClass("disabled"),$("#sUserChangeEmail").removeClass("disabled")):($(userElement).removeClass("selected"),$("#sUserName").text("No User Selected"),$("#sUserChangeName").addClass("disabled"),$("#sUserChangePass").addClass("disabled"),$("#sUserChangeEmail").addClass("disabled"))},loadOverview:function(){alexander.ajax.req("loadUserOverview","",function(response){$("#userList").html(response),$(".userItem").click(function(){alexander.account.user.loadControl(this)}),alexander.account.user.renderOverview()})}},changePass:function(){var p=$("#pass");p.children().remove();p.append("<form class='form-horizontal' action='index.php' method='post'><input id='newPass' type='password' name='password' placeholder='New Password' class='form-control passField'><input type='password' name='passwordCheck' placeholder='New Password (Repeat)' class='form-control passField'><input type='password' name='passwordOld' placeholder='Old Password' class='form-control passField'><input type='submit' class='btn btn-primary' value='Change Password'></form>"),$("#newPass").focus()}};;alexander.ajax={req:function(method,ajaxData,callbackFn){var ajaxObject={ajaxMethod:method,data:ajaxData};AJAX_LOGGING&&(console.log("AJAX_REQ_START: method="+method),console.log(ajaxData),console.log("AJAX_REQ_END")),$.ajax({type:"POST",url:"ajax.php",data:ajaxObject,success:function(result){AJAX_LOGGING&&(console.log("AJAX_RESP_START"),console.log(result),console.log("AJAX_RESP_END")),callbackFn(result)}})}};;!function(_a){_a.markup={insert:function(){var range=alexander.select.getRange();alexander.select.replaceWithHTML("<span contenteditable='false' id='markupStart' class='handle left red'></span>"+range+"<span id='markupEnd' contenteditable='false' class='handle right red'></span>"),alexander.markup.requestID()},requestID:function(){alexander.ajax.req("requestMarkupID","",function(responseText){var objS=$("#markupStart").get(0),objE=$("#markupEnd").get(0);objS.id=responseText+"_start",objE.id=responseText+"_end",objS.title=objE.title=responseText,alexander.markup.registerListeners(),alexander.markup.load(responseText)})},registerListeners:function(){$(".handle").each(function(index,handle){var cHandle=$(handle);cHandle.unbind("mousedown").mousedown(function(event){alexander.markup.load(this.innerHTML)}),cHandle.unbind("mouseover").mouseover(function(event){alexander.markup.highlight(this.title,!0,!0)}),cHandle.unbind("mouseout").mouseout(function(event){alexander.markup.highlight(this.title,!1)})})},list:function(){var markups=$(".handle").filter(function(){return-1!=$(this).attr("id").indexOf("_start")}),markupRow=$("#markupRow");markupRow.children().remove(),markups.each(function(index,markup){var m=$(markup),id=m.attr("id").replace("_start",""),className=m.attr("class").replace("handle","").replace("selected","").replace("left","");markupRow.append("<div class='col-xs-12 markupItem "+className+"' id='"+id+"_holder' markup-id='"+id+"'>Markup<span class='btn-group btn-group-xs pull-right'><button class='btn btn-default' onclick='alexander.markup.move("+id+")'><span class='glyphicon glyphicon-resize-horizontal'></span>&nbsp;Move</button><button class='btn btn-default'><span class='glyphicon glyphicon-pencil'></span>&nbsp;Edit</button><button class='btn btn-default'><span class='glyphicon glyphicon-search'></span>&nbsp;Focus</button><button class='btn btn-danger'><span class='glyphicon glyphicon-remove-circle'></span>&nbsp;Remove</button></span></div>")}),$(".markupItem").each(function(index,item){var m=$(item);m.unbind("mouseout").mouseout(function(event){alexander.markup.highlight($(this).attr("markup-id"),!1)}),m.unbind("mouseover").mouseover(function(event){alexander.markup.highlight($(this).attr("markup-id"),!0,!0)})})},load:function(id){void 0==$("#holder_"+id).get(0)&&alexander.ajax.req("loadMarkup",id,function(responseText){alexander.markup.registerListeners(),alexander.select.clear()})},move:function(id){var markupStart=$("#"+id+"_start"),markupEnd=$("#"+id+"_end"),startString=markupStart.wrap("<span/>").parent().html(),endString=markupEnd.wrap("<span/>").parent().html();markupStart.unwrap().remove(),markupEnd.unwrap().remove(),alexander.select.replaceWithHTML(startString+alexander.select.getRange()+endString),alexander.markup.registerListeners()},highlight:function(markupID,doHighlight,showWindow){if(void 0!=markupID&&-1!=markupID){void 0==showWindow&&(showWindow=!1);var start=$("#"+markupID+"_start"),end=$("#"+markupID+"_end"),holder=$("#"+markupID+"_holder");doHighlight?(start.addClass("selected"),end.addClass("selected"),holder.addClass("selected")):(start.removeClass("selected"),end.removeClass("selected"),holder.removeClass("selected"))}},save:function(markupID){eval($("#close"+markupID+"Script").get(0).innerHTML)}}}(alexander);;alexander.editor={new:function(areaID){return editor=new nicEditor({buttonList:["bold","italic","underline","strikeThrough","subscript","superscript"]}),editor.panelInstance(areaID),editor},exit:function(){index=window.location.href.indexOf("?"),window.location=window.location.href.substring(0,index)}};;!function(_a){function appendNote(id,content){if(null==$(id)){var note=alexander.ce("li");note.id=id,note.innerHTML=id+": "+content,$("app").appendChild(note)}}function $(id){return document.getElementById(id)}alexander.print={load:function(handle){void 0!=handle&&alexander.ajax.req("loadMarkup",handle.innerHTML,function(responseText){parts=responseText.split("::"),appendNote(parts[0],parts[1]),handle.className="note",loadHandle(document.getElementsByClassName("handle")[0])})}}}();;!function(_a){function updateTextOverview(){var query=$("#textFilter").val().trim();0!=(query=query.toLowerCase()).length?$(".textlink").each(function(i,item){-1!=$(item).text().toLowerCase().indexOf(query)?$(item).show():$(item).hide()}):$(".textlink").show()}function orderTextOverview(){var order=$("#textOrder").val().trim().toLowerCase(),items=$(".textlink").get(),orderClass=order.startsWith("title")?".loaderTitle":order.startsWith("name")?".loaderName":".loaderAuthor";items.sort(function(a,b){var textA=$(a).find(orderClass).text(),textB=$(b).find(orderClass).text();return textA<textB?1:textB<textA?-1:0}),-1==order.indexOf("desc")&&items.reverse(),$.each(items,function(i,item){$("#textOverview").append(item)})}alexander.text={load:function(){alexander.ajax.req("loadText",alexander.util.getUrlVars().txtID,function(responseText){nicEditors.findEditor("textEditor").setContent(decodeURI(responseText)),alexander.markup.registerListeners(),alexander.markup.list()})},save:function(andExit){var saveData={textContent:encodeURI(nicEditors.findEditor("textEditor").getContent().replace(/&nbsp;/g," ")),authorName:$("#authorField").val().toLowerCase(),textName:$("#textNameField").val(),textTitle:$("#titleField").val(),locusF:$("#locusFromField").val(),locusT:$("#locusToField").val(),checkIn:andExit,textStatusSelect:$("#textStatusSelect").val()};alexander.ajax.req("saveText",saveData,function(responseText){switch(responseText){case"OK":andExit&&alexander.editor.exit();break;case"DB_ERR":alert("A database error occured. Saving has failed. Try again later.");break;case"AUTH_RES_ERR":alert("A result error has occured. This authorName is not yet registered. And you don't have the necessary privileges to register a new author");break;default:console.log("ERR:"+responseText)}})},create:function(){alexander.ajax.req("newText","",function(responseText){document.location=responseText})},loadOverview:function(){alexander.ajax.req("loadTextOverview","",function(responseText){$("#textOverview").html(responseText),alexander.text.renderOverview()}),setTimeout(function(){$(".animated.fadeIn").removeClass("animated fadeIn")},500)},renderOverview:function(){updateTextOverview(),orderTextOverview()}}}();;$(document).ready(function(){alexander.event.registerDocumentListeners(),"function"==typeof init&&init()}),String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)},String.prototype.replaceAll=function(search,replacement){return this.replace(new RegExp(search,"g"),replacement)};